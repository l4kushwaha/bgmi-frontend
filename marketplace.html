<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>BGMI Marketplace</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- ================= BASIC STYLES ================= -->
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #0f172a;
      color: #fff;
    }

    header {
      padding: 15px;
      display: flex;
      gap: 10px;
      background: #020617;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    header input, header select {
      padding: 10px;
      border-radius: 6px;
      border: none;
      outline: none;
      flex: 1;
    }

    #items-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 15px;
      padding: 15px;
    }

    .item-card {
      background: #020617;
      border-radius: 12px;
      padding: 12px;
      position: relative;
      overflow: hidden;
    }

    .rating-badge {
      position: absolute;
      top: 10px;
      left: 10px;
      background: #16a34a;
      padding: 4px 8px;
      border-radius: 20px;
      font-size: 12px;
    }

    .verified-badge {
      position: absolute;
      top: 10px;
      right: 10px;
      background: #2563eb;
      padding: 4px 8px;
      border-radius: 20px;
      font-size: 12px;
    }

    .item-info p {
      margin: 4px 0;
      font-size: 14px;
    }

    .price {
      font-size: 18px;
      color: #22c55e;
      font-weight: bold;
    }

    /* ================= IMAGE CAROUSEL ================= */
    .carousel {
      position: relative;
      overflow: hidden;
      border-radius: 10px;
      margin: 10px 0;
    }

    .carousel-track {
      display: flex;
      transition: transform 0.4s ease;
    }

    .carousel img {
      width: 100%;
      height: 180px;
      object-fit: cover;
      flex-shrink: 0;
      cursor: pointer;
    }

    .carousel-btn {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(0,0,0,0.5);
      border: none;
      color: white;
      font-size: 22px;
      padding: 6px 10px;
      cursor: pointer;
      z-index: 2;
    }

    .carousel-btn.prev { left: 5px; }
    .carousel-btn.next { right: 5px; }

    .dots {
      display: flex;
      justify-content: center;
      gap: 5px;
      margin-top: 5px;
    }

    .dot {
      width: 8px;
      height: 8px;
      background: #475569;
      border-radius: 50%;
    }

    .dot.active {
      background: #22c55e;
    }

    /* ================= BUTTONS ================= */
    .btn {
      width: 100%;
      margin-top: 6px;
      padding: 8px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-weight: bold;
    }

    .buy-btn {
      background: #22c55e;
      color: black;
    }

    .outline {
      background: transparent;
      border: 1px solid #475569;
      color: white;
    }

    .edit-btn { background: #facc15; }
    .delete-btn { background: #ef4444; }

    /* ================= MODALS ================= */
    .modal-bg {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.8);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 50;
    }

    .modal-bg.active { display: flex; }

    .modal {
      background: #020617;
      padding: 20px;
      max-width: 500px;
      width: 90%;
      border-radius: 12px;
    }

    #imgModal img {
      max-width: 100%;
      max-height: 90vh;
    }

    /* ================= TOAST ================= */
    #toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      padding: 10px 20px;
      background: #16a34a;
      border-radius: 20px;
      display: none;
      z-index: 100;
    }

    #toast.show { display: block; }
  </style>
</head>

<body>

<!-- ================= HEADER ================= -->
<header>
  <input type="text" id="search" placeholder="Search UID / title" />
  <select id="filter">
    <option value="">All</option>
    <option value="own">My Listings</option>
    <option value="price_low">Price Low â†’ High</option>
    <option value="price_high">Price High â†’ Low</option>
    <option value="new">Newest</option>
  </select>
</header>

<!-- ================= LISTINGS ================= -->
<div id="items-container"></div>

<!-- ================= IMAGE MODAL ================= -->
<div class="modal-bg" id="imgModal" onclick="this.classList.remove('active')">
  <img id="imgPreview" />
</div>

<!-- ================= SELLER MODAL ================= -->
<div class="modal-bg" id="seller-modal-bg">
  <div class="modal" id="seller-content"></div>
</div>

<!-- ================= TOAST ================= -->
<div id="toast"></div>

<!-- ================= YOUR EXISTING JS ================= -->
<script src="marketplace.js"></script>

<!-- ================= ENHANCEMENTS (NO MARKETPLACE.JS TOUCH) ================= -->
<script>
/* ======================================================
   ðŸ”„ AUTO IMAGE CAROUSEL + SWIPE + AUTOPLAY
====================================================== */
function enhanceGalleries(){
  document.querySelectorAll(".images-gallery").forEach(gallery=>{
    if(gallery.dataset.done) return;
    gallery.dataset.done = "1";

    const imgs = [...gallery.querySelectorAll("img")];
    if(imgs.length <= 1) return;

    const carousel = document.createElement("div");
    carousel.className = "carousel";

    const track = document.createElement("div");
    track.className = "carousel-track";

    imgs.forEach(i => track.appendChild(i));
    carousel.appendChild(track);

    let index = 0;
    const dots = document.createElement("div");
    dots.className = "dots";

    imgs.forEach((_,i)=>{
      const d = document.createElement("div");
      d.className = "dot" + (i===0?" active":"");
      dots.appendChild(d);
    });

    const update = ()=>{
      track.style.transform = `translateX(-${index*100}%)`;
      dots.querySelectorAll(".dot").forEach((d,i)=>d.classList.toggle("active",i===index));
    };

    const prev = document.createElement("button");
    prev.className="carousel-btn prev";
    prev.innerHTML="â€¹";
    prev.onclick=()=>{ index=(index-1+imgs.length)%imgs.length; update(); };

    const next = document.createElement("button");
    next.className="carousel-btn next";
    next.innerHTML="â€º";
    next.onclick=()=>{ index=(index+1)%imgs.length; update(); };

    carousel.append(prev,next);
    gallery.replaceWith(carousel);
    carousel.after(dots);

    setInterval(()=>{ index=(index+1)%imgs.length; update(); },4000);
  });
}

new MutationObserver(enhanceGalleries)
  .observe(document.body,{childList:true,subtree:true});

/* ======================================================
   ðŸ” WATERMARK + âš¡ WEBP + ðŸ“Š ANALYTICS
====================================================== */
const supportsWebP = (()=> {
  try {
    return document.createElement("canvas")
      .toDataURL("image/webp").includes("webp");
  } catch { return false; }
})();

const analytics = JSON.parse(localStorage.getItem("img_analytics")||"{}");

function track(id,type){
  analytics[id] ??= {views:0};
  analytics[id][type]=(analytics[id][type]||0)+1;
  localStorage.setItem("img_analytics",JSON.stringify(analytics));
}

async function watermark(img){
  const c=document.createElement("canvas");
  const ctx=c.getContext("2d");
  c.width=img.naturalWidth;
  c.height=img.naturalHeight;
  ctx.drawImage(img,0,0);
  ctx.fillStyle="rgba(255,255,255,0.35)";
  ctx.font="24px Arial";
  ctx.fillText("BGMI MARKET",c.width-180,c.height-20);
  return c.toDataURL();
}

document.addEventListener("load",async e=>{
  if(e.target.tagName==="IMG"){
    track(e.target.src,"views");
    e.target.src = await watermark(e.target);
  }
},true);
</script>

</body>
</html>