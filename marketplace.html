<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>BGMI Marketplace</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>
/* ================= ORIGINAL STYLES ================= */
body{
  margin:0;
  font-family:'Poppins',sans-serif;
  background:linear-gradient(135deg,#141e30,#243b55);
  color:#fff;
  overflow-x:hidden;
  transition:.3s;
}
body.dark{
  background:linear-gradient(135deg,#1a1a1a,#2c2c2c);
}

#particle-canvas{position:fixed;inset:0;z-index:0;}

header{
  position:relative;
  z-index:2;
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:15px 20px;
  backdrop-filter:blur(12px);
  background:rgba(255,255,255,0.05);
  border-bottom:1px solid rgba(255,255,255,0.1);
  border-radius:12px;
}

#items-container{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(280px,1fr));
  gap:16px;
  padding:16px;
  max-width:1400px;
  margin:auto;
  position:relative;
  z-index:2;
}

.item-card{
  background:rgba(255,255,255,0.05);
  backdrop-filter:blur(12px);
  border-radius:16px;
  padding:12px;
  box-shadow:0 8px 24px rgba(0,0,0,0.25);

  /* animation base */
  opacity:0;
  transform:translateY(40px) scale(.95);
  transition:transform .25s ease, box-shadow .25s ease, opacity .7s ease;
  transform-style:preserve-3d;
  will-change:transform,opacity;
}

.item-card:hover{
  box-shadow:0 18px 40px rgba(0,0,0,.35);
}

/* ================= SKELETON ================= */
.skeleton{
  background:linear-gradient(90deg,#aaa,#ddd,#aaa);
  background-size:200%;
  animation:skeleton 1.2s infinite;
  border-radius:12px;
}
.skeleton.img{
  height:140px;
  margin-bottom:8px;
}

@keyframes skeleton{
  from{background-position:200%}
  to{background-position:-200%}
}

@media(max-width:768px){
  .item-card:hover{transform:none}
}
</style>
</head>

<body>
<canvas id="particle-canvas"></canvas>

<header>
  <h1>BGMI Marketplace</h1>
  <button id="dark-toggle">Dark / Light</button>
</header>

<div id="items-container"></div>

<!-- ================= EXISTING SCRIPT ================= -->
<script src="js/marketplace.js"></script>

<!-- ================= ORIGINAL INTERNAL SCRIPT ================= -->
<script>
document.getElementById("dark-toggle")
  .addEventListener("click",()=>document.body.classList.toggle("dark"));

const c=document.getElementById("particle-canvas");
const ctx=c.getContext("2d");
function resize(){c.width=innerWidth;c.height=innerHeight}
resize();addEventListener("resize",resize);

const dots=[...Array(90)].map(()=>({
  x:Math.random()*c.width,
  y:Math.random()*c.height,
  r:Math.random()*2+1,
  dx:(Math.random()-.5)*0.6,
  dy:(Math.random()-.5)*0.6
}));

(function animate(){
  ctx.clearRect(0,0,c.width,c.height);
  dots.forEach(p=>{
    ctx.beginPath();
    ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
    ctx.fillStyle="rgba(255,255,255,.6)";
    ctx.fill();
    p.x+=p.dx;p.y+=p.dy;
    if(p.x<0)p.x=c.width;
    if(p.y<0)p.y=c.height;
    if(p.x>c.width)p.x=0;
    if(p.y>c.height)p.y=0;
  });
  requestAnimationFrame(animate);
})();
</script>

<!-- ================= NEW SAFE ANIMATION SCRIPT ================= -->
<script>
/* ===== Dynamic-safe animation handler (for marketplace.js cards) ===== */

const animatedCards=new WeakSet();

/* Enhance one card */
function enhanceCard(card){
  if(animatedCards.has(card)) return;
  animatedCards.add(card);

  /* Skeleton for images */
  card.querySelectorAll("img").forEach(img=>{
    if(img.complete) return;
    const sk=document.createElement("div");
    sk.className="skeleton img";
    img.before(sk);
    img.style.display="none";
    img.onload=()=>{
      sk.remove();
      img.style.display="block";
    };
  });

  /* Scroll animation */
  scrollObserver.observe(card);

  /* 3D tilt */
  card.addEventListener("mousemove",e=>{
    const r=card.getBoundingClientRect();
    const x=e.clientX-r.left;
    const y=e.clientY-r.top;
    const rx=((y/r.height)-0.5)*-10;
    const ry=((x/r.width)-0.5)*10;
    card.style.transform=
      `rotateX(${rx}deg) rotateY(${ry}deg) scale(1.03)`;
  });

  card.addEventListener("mouseleave",()=>{
    card.style.transform="";
  });
}

/* Scroll observer */
const scrollObserver=new IntersectionObserver(entries=>{
  entries.forEach(e=>{
    if(e.isIntersecting){
      e.target.style.opacity="1";
      e.target.style.transform="translateY(0) scale(1)";
      scrollObserver.unobserve(e.target);
    }
  });
},{threshold:.2});

/* Observe dynamic cards */
const container=document.getElementById("items-container");
new MutationObserver(muts=>{
  muts.forEach(m=>{
    m.addedNodes.forEach(n=>{
      if(n.classList?.contains("item-card")){
        enhanceCard(n);
      }
    });
  });
}).observe(container,{childList:true});

/* Initial cards */
document.querySelectorAll(".item-card").forEach(enhanceCard);
</script>

</body>
</html>